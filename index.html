<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Sinalizador SSE</title>
</head>
<body>
  <script>
    const eventSource = new EventSource("https://ffbrunoff.app.n8n.cloud/webhook/sse-imagem");

    const encerramento = () => {
      try {
        eventSource.close(); // Encerra
      } catch (e) {}
    };

    eventSource.addEventListener("imagem_atualizada", (event) => {
      parent.postMessage({ tipo: "imagem_atualizada" }, "*");
      encerramento();
    });

    eventSource.onerror = (e) => {
      console.error("Erro na conexão SSE:", e);
      encerramento();
    };

    // força encerramento após 2s
    setTimeout(encerramento, 2000);
  </script>
  <p style="font-family: sans-serif;">Sinalizador ativo...</p>
</body>
</html>
